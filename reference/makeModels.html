<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Build model matrices for differential expression — makeModels • derfinder</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet"><meta property="og:title" content="Build model matrices for differential expression — makeModels"><meta property="og:description" content="Builds the model matrices for testing for differential expression by
comparing a model with a grouping factor versus one without it. It adjusts
for the confounders specified and the median coverage of each sample. The
resulting models can be used in calculateStats."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">derfinder</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.35.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/derfinder-quickstart.html">derfinder quick start guide</a>
    </li>
    <li>
      <a href="../articles/derfinder-users-guide.html">derfinder users guide</a>
    </li>
  </ul></li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/lcolladotor/derfinder/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Build model matrices for differential expression</h1>
    <small class="dont-index">Source: <a href="https://github.com/lcolladotor/derfinder/blob/HEAD/R/makeModels.R" class="external-link"><code>R/makeModels.R</code></a></small>
    <div class="hidden name"><code>makeModels.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Builds the model matrices for testing for differential expression by
comparing a model with a grouping factor versus one without it. It adjusts
for the confounders specified and the median coverage of each sample. The
resulting models can be used in <a href="calculateStats.html">calculateStats</a>.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">makeModels</span><span class="op">(</span><span class="va">sampleDepths</span>, <span class="va">testvars</span>, adjustvars <span class="op">=</span> <span class="cn">NULL</span>, testIntercept <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>sampleDepths</dt>
<dd><p>Per sample library size adjustments calculated with
<a href="sampleDepth.html">sampleDepth</a>.</p></dd>


<dt>testvars</dt>
<dd><p>A vector or matrix specifying the variables to test. For
example, a factor with the group memberships when testing for differences
across groups. It's length should match the number of columns used from
<code>coverageInfo$coverage</code>.</p></dd>


<dt>adjustvars</dt>
<dd><p>Optional matrix of adjustment variables (e.g. measured
confounders, output from SVA, etc.) to use in fitting linear models to each
nucleotide. These variables have to be specified by sample and the number of
rows must match the number of columns used. It will also work if it is a
vector of the correct length.</p></dd>


<dt>testIntercept</dt>
<dd><p>If <code>TRUE</code> then <code>testvars</code> is ignored and mod0
will contain the column medians and any adjusting variables specified, but
no intercept.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>A list with two components.</p><dl><dt>mod </dt>
<dd><p>The alternative model matrix.</p></dd>

<dt>mod0 </dt>
<dd><p>The null model matrix.</p></dd>


</dl></div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p><a href="sampleDepth.html">sampleDepth</a>, <a href="calculateStats.html">calculateStats</a></p></div>
    </div>
    <div id="author">
    <h2>Author</h2>
    <p>Leonardo Collado-Torres</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co">## Collapse the coverage information</span></span></span>
<span class="r-in"><span><span class="va">collapsedFull</span> <span class="op">&lt;-</span> <span class="fu"><a href="collapseFullCoverage.html">collapseFullCoverage</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">genomeData</span><span class="op">$</span><span class="va">coverage</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    verbose <span class="op">=</span> <span class="cn">TRUE</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> 2023-05-07 05:11:51.648825 collapseFullCoverage: Sorting fullCov</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> 2023-05-07 05:11:51.651262 collapseFullCoverage: Collapsing chromosomes information by sample</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Calculate library size adjustments</span></span></span>
<span class="r-in"><span><span class="va">sampleDepths</span> <span class="op">&lt;-</span> <span class="fu"><a href="sampleDepth.html">sampleDepth</a></span><span class="op">(</span><span class="va">collapsedFull</span>,</span></span>
<span class="r-in"><span>    probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span><span class="op">)</span>, nonzero <span class="op">=</span> <span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>    verbose <span class="op">=</span> <span class="cn">TRUE</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> 2023-05-07 05:11:51.653272 sampleDepth: Calculating sample quantiles</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> 2023-05-07 05:11:51.65879 sampleDepth: Calculating sample adjustments</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Build the models</span></span></span>
<span class="r-in"><span><span class="va">group</span> <span class="op">&lt;-</span> <span class="va">genomeInfo</span><span class="op">$</span><span class="va">pop</span></span></span>
<span class="r-in"><span><span class="va">adjustvars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">genomeInfo</span><span class="op">$</span><span class="va">gender</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">models</span> <span class="op">&lt;-</span> <span class="fu">makeModels</span><span class="op">(</span><span class="va">sampleDepths</span>, testvars <span class="op">=</span> <span class="va">group</span>, adjustvars <span class="op">=</span> <span class="va">adjustvars</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">models</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "mod"  "mod0"</span>
<span class="r-in"><span><span class="va">models</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $mod</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    (Intercept) testvarsYRI sampleDepths adjustVar1male</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1            1           0     8.366322              0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2            1           0     7.954196              0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3            1           0     9.379378              1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4            1           0     8.596190              0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5            1           0     8.523562              0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6            1           0     8.179909              0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7            1           0     6.129283              1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 8            1           0     8.233620              0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 9            1           0     7.266787              0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 10           1           0     8.400879              0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11           1           0     8.044394              0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 12           1           0     6.727920              1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 13           1           0     7.366322              0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 14           1           0     9.134426              0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 15           1           0     8.044394              0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 16           1           0     8.262095              0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 17           1           0     8.991522              0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 18           1           0     7.000000              0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 19           1           0     6.727920              1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 20           1           0     7.285402              0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 21           1           0     9.214319              1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 22           1           1     6.066089              0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 23           1           1     6.285402              0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 24           1           1     5.000000              0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 25           1           1     5.000000              0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 26           1           1     5.000000              0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 27           1           1     6.285402              0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 28           1           1     5.000000              0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 29           1           1     5.000000              0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 30           1           1     5.000000              0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 31           1           1     5.000000              0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"assign")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0 1 2 3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"contrasts")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"contrasts")$testvars</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "contr.treatment"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"contrasts")$adjustVar1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "contr.treatment"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $mod0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    (Intercept) sampleDepths adjustVar1male</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1            1     8.366322              0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2            1     7.954196              0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3            1     9.379378              1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4            1     8.596190              0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5            1     8.523562              0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6            1     8.179909              0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7            1     6.129283              1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 8            1     8.233620              0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 9            1     7.266787              0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 10           1     8.400879              0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11           1     8.044394              0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 12           1     6.727920              1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 13           1     7.366322              0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 14           1     9.134426              0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 15           1     8.044394              0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 16           1     8.262095              0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 17           1     8.991522              0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 18           1     7.000000              0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 19           1     6.727920              1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 20           1     7.285402              0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 21           1     9.214319              1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 22           1     6.066089              0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 23           1     6.285402              0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 24           1     5.000000              0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 25           1     5.000000              0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 26           1     5.000000              0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 27           1     6.285402              0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 28           1     5.000000              0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 29           1     5.000000              0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 30           1     5.000000              0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 31           1     5.000000              0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"assign")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0 1 2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"contrasts")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"contrasts")$adjustVar1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "contr.treatment"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Leonardo Collado-Torres, Andrew E. Jaffe, Jeffrey T. Leek.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer></div>

  


  

  </body></html>

